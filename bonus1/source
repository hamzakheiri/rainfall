#include <stdlib.h>
#include <string.h>
#include <unistd.h>

int main(int argc, char **argv) {
    char buffer[40];        // Buffer at offset -0x3c from EBP
    int num;                // Variable that gets checked

    // Convert first argument to integer
    num = atoi(argv[1]);

    // Check if num > 9
    if (num > 9) {
        return 1;
    }

    // VULNERABLE: Integer overflow!
    // Copies (num << 2) bytes, which is (num * 4)
    // If num is negative, it passes the > 9 check
    // But (num << 2) can be a large positive number!
    memcpy(buffer, argv[2], num << 2);

    // Check if num equals 0x574f4c46 (magic value "FLOW")
    if (num == 0x574f4c46) {
        execl("/bin/sh", "sh", NULL);
    }

    return 0;
}